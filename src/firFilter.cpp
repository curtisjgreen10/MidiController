/*
 * firFilter.cpp
 *
 *  Created on: Apr 13, 2021
 *      Author: cjgree13
 */

#include "firFilter.h"

static float FIR_IMPULSE_RESPONSE[FIR_FILTER_LENGTH] =
{
		 0.000000002396930607626541243393302022219,
		 0.000000001664776410637526965299718560611,
		 0.000000002380495580571911390306229209146,
		 0.000000003300322967667351736921401645698,
		 0.00000000445962271637962409199788696261 ,
		 0.000000005895944571652311988393376445501,
		 0.00000000764844273212407746233032376738 ,
		 0.000000009757120376952029639136329129852,
		 0.000000012261883243811818052925920673971,
		 0.000000015201386856244240857062290052035,
		 0.000000018611663720799779268653335634505,
		 0.000000022524519076598420659007196865248,
		 0.000000026965686614022012454875258939853,
		 0.000000031952739012372796706084308350493,
		 0.000000037492752196601711142658226987717,
		 0.000000043579726891434926353241204391442,
		 0.000000050191776357107097173010503777038,
		 0.000000057288095114003862117524096438104,
		 0.000000064805729980505911972627299845462,
		 0.000000072656181823789986346831505040905,
		 0.000000080721874005645811423582470026106,
		 0.000000088852531532270105212937259288319,
		 0.000000096861523304694811775256157743846,
		 0.000000104522228523168200235414775252363,
		 0.000000111564497108562884631099466643117,
		 0.000000117671282842883252656928868857406,
		 0.000000122475536653037787412204632185586,
		 0.000000125557455911595042619276923513694,
		 0.000000126442193632156676504755036215266,
		 0.00000012459813881168979547805120058207 ,
		 0.00000011943588571992791571743208322437 ,
		 0.000000110308015457362109242838018544758,
		 0.000000096509817376506257407373806124495,
		 0.000000077281080783276037466922303836164,
		 0.000000051809088473199620455320973900701,
		 0.000000019232942908803300339465433728414,
		-0.000000021350647014439996376710575033513,
		-0.000000070879995828980403850946769451352,
		-0.000000130319372861519847654025185644533,
		-0.000000200648130318658459602231144101869,
		-0.000000282847936466454901847272004195011,
		-0.000000377888038388417897487216254998055,
		-0.000000486708497978596906420221349792721,
		-0.000000610201367095882416038694472798509,
		-0.000000749189793239281927920384263758224,
		-0.000000904405075640931790504457258444981,
		-0.000001076461723293720051990380107143075,
		-0.000001265830600987301026778180171317167,
		-0.000001472810286779863601323023805655943,
		-0.000001697496804250970462677209835145042,
		-0.000001939751935085209257991593900793958,
		-0.00000219917036169727498520049500940754 ,
		-0.000002475045935331314285882944523087268,
		-0.000002766337411863189636772666912811758,
		-0.000003071634044956596012570506845640317,
		-0.000003389121473598519991327245037826543,
		-0.000003716548387845536864675837288030102,
		-0.000004051194502068812136618986691205535,
		-0.000004389840408440710320099684832451103,
		-0.000004728739924038426198165362135394929,
		-0.000005063595581964733320342111899670101,
		-0.000005389537949461133355176598730418291,
		-0.00000570110948328748057235219187655062 ,
		-0.000005992253653705041965187114844093585,
		-0.000006256310082548356923839820431521019,
		-0.000006486016446994931648533863621786111,
		-0.00000667351789819131007065354174723204 ,
		-0.000006810384731814971728098249970084765,
		-0.00000688763902541243000629198056650182 ,
		-0.000006895790924118664881755334794544154,
		-0.00000682488521160732210230461317057582 ,
		-0.000006664558746316399588758162125801121,
		-0.000006404109273699532628128846395432205,
		-0.00000603257604315748129558466192334798 ,
		-0.000005538832563406060692891893365574774,
		-0.000004911691721948613221344036305904268,
		-0.000004140023373692794325673111749397393,
		-0.000003212884370318632226221555389655826,
		-0.000002119660856745947715557270435438042,
		-0.000000850222504220855400486832852136043,
		 0.000000604911817751532320185613427615534,
		 0.000002254397605251404101598354523527945,
		 0.000004105878379309211461452994162968366,
		 0.000006165790492643795155883884584469001,
		 0.000008439160332664095130490028440206629,
		 0.000010929395370623045944985692046191872,
		 0.000013638070708629183660251342480318471,
		 0.000016564712977944633955345449249918488,
		 0.000019706583640151562438402529919834194,
		 0.000023058463935834842985618878263842646,
		 0.00002661244391013232156190798649575413 ,
		 0.000030357718118531891557561330774461794,
		 0.000034280390776782843987105509064861053,
		 0.000038363293262821272419909462980669446,
		 0.000042585817003249633024095782696250012,
		 0.000046923764879943878202284840428504253,
		 0.000051349224369545443677834151152694631,
		 0.000055830465679190601781776981393790038,
		 0.000060331868160997161596500321101288478,
		 0.000064813878275052759655137923910928066,
		 0.000069233002321989327320674034726977197,
		 0.000073541837080832905457726533793305634,
		 0.000077689141362707571846976661866790437,
		 0.000081619951325856082507102795542408558,
		 0.000085275742189515601207952522067046175,
		 0.000088594638734302481961752073758020742,
		 0.00009151167668274805537965282953294377 ,
		 0.00009395911671711881167461111186156586 ,
		 0.000095866812511109642707188283061725542,
		 0.000097162633730613846209760164907009994,
		 0.000097772944495455937972787363587912068,
		 0.000097623137292800511179667599659381949,
		 0.000096638221794623647541849775777222931,
		 0.00009474346746058144434245174014819213 ,
		 0.000091865098205579683986882200130708043,
		 0.000087931036784550688483602653988668862,
		 0.00008287169589748757036681836574132376 ,
		 0.000076620812352964391819462597332801579,
		 0.000069116319951497283045026287506829021,
		 0.000060301256069734153529657977310662886,
		 0.000050124696245685911553946478846910395,
		 0.000038542710394313854183143824849722137,
		 0.000025519333625790565581864521860211426,
		 0.000011027544005112366697746693888770864,
		-0.000004949761012625058697515876421357817,
		-0.000022418798302432819816772807675064882,
		-0.000041373952297783854296919781035057895,
		-0.000061796857546517658561768815417281075,
		-0.000083655520820833113968158223361371029,
		-0.000106903493345251115282865117528388055,
		-0.000131479103969993577159108832930201061,
		-0.000157304764295797044545976994811553595,
		-0.000184286356848010888414071684060502321,
		-0.000212312717392478683426509933340753378,
		-0.000241255222381964547955293665104647971,
		-0.000270967492310102890749196058450820601,
		-0.000301285221432207408510939306012232919,
		-0.000332026143878859315763246717878587333,
		-0.00036299014564320771858776937257573536 ,
		-0.00039395953125877583578251517337776022 ,
		-0.00042469945320839361854042826038835301 ,
		-0.00045495851120855079546476118501630026 ,
		-0.000484469527508413319756563897300338795,
		-0.000512950503224078482693293334904183212,
		-0.00054010575950639812866510558464483438 ,
		-0.000565627266015876939593554073582026831,
		-0.000589196157762905984786594437707663019,
		-0.00061048443986648482078444244436354893 ,
		-0.000629156878206911995485284272433545993,
		-0.000644873072300383579427696112418288976,
		-0.000657289705024382436317209599252464614,
		-0.00066606296207608137877054232944828982 ,
		-0.000670851112275791289403514827682784016,
		-0.000671317238036444013764281191214422506,
		-0.000667132103532363531471494066948935142,
		-0.000657977146326249530579322044587797791,
		-0.000643547576471984036569629061830255523,
		-0.000623555565414505826374313990356768045,
		-0.000597733505380880839052970543434639694,
		-0.000565837318407209368363586232675288556,
		-0.000527649792698514186022051841717939169,
		-0.000482983922683650275693711950708575387,
		-0.000431686227929297316671664042075917678,
		-0.000373640025020531064449402780525133494,
		-0.000308768625628724399916763543316733376,
		-0.000237038433273460393208367791295643201,
		-0.000158461910767623034672346715723278976,
		-0.000073100390013512996068532900917347206,
		 0.000018933304279335539836237947697306083,
		 0.000117472445266562108855991353184577974,
		 0.000222294236985841781343783973845518176,
		 0.000333117917084995254252410834538977724,
		 0.000449603155787084971840850133872891092,
		 0.000571348776545641976951084295421878778,
		 0.000697891822512748953750982838784011619,
		 0.000828706991377273043120066375877286191,
		 0.000963206459320992895538349198858441014,
		 0.001100740112801376320919577445067716326,
		 0.001240596204598692865392339790275855194,
		 0.001382002448089829794303229348884087813,
		 0.001524127561023260087058606160326235113,
		 0.001666083267204702218419742898447566404,
		 0.001806926761458744513932916930798455724,
		 0.001945663640047682859182676118336985382,
		 0.002081251295402141657936434526732227823,
		 0.002212602770597516498030099540983428597,
		 0.002338591065493833554000957519747316837,
		 0.002458053882894811921488997796814146568,
		 0.002569798799479090442576811881281173555,
		 0.002672608842660579263339482025685356348,
		 0.002765248450957612930123374894719745498,
		 0.002846469791935691412421149948386300821,
		 0.002915019408353700276770315014118750696,
		 0.002969645159830809101608739553057603189,
		 0.003009103424174920399930543979394315102,
		 0.003032166519523437058641901487021641515,
		 0.003037630305648347708163958813543104043,
		 0.003024321920221848761928251647645993216,
		 0.002991107603527993433895071362371709256,
		 0.002936900563093465185704467046434729127,
		 0.002860668827985919215189936082310850907,
		 0.002761443041150475966039046227251674281,
		 0.002638324137105734802644096959056696505,
		 0.002490490851651269189892534683394842432,
		 0.002317207009932630620147042677103854658,
		 0.0021178285393052471465014097162793405  ,
		 0.001891810153921512751076794422999682865,
		 0.001638711658859137547394890788154953043,
		 0.001358203822901524367161574247120370273,
		 0.001050073770785017734930022470507537946,
		 0.000714229847820755693599270585991689586,
		 0.000350705912298404772972637566397224873,
		-0.000040334986055932940706477557446518745,
		-0.000458597580048976665063886759554634409,
		-0.000903652046319041498539936796419169696,
		-0.001374932384938617807232374978809730237,
		-0.001871735544088323028796838620735343284,
		-0.002393221312058830228808314899424658506,
		-0.002938412994103864386147284548655989056,
		-0.003506198886692798912662061283640468901,
		-0.004095334556581193413693497973326884676,
		-0.004704445926814728069775828345200352487,
		-0.00533203316639755970501868276301138394 ,
		-0.005976475374880869592675303181295021204,
		-0.006636036047643150380392906839688293985,
		-0.007308869302149423492764857002157441457,
		-0.0079930268400584796734120729411188222  ,
		-0.008686465614716868538502936303302703891,
		-0.009387056168402707970188636465991294244,
		-0.010092591598665236890530749747085792478,
		-0.010800797108336512505899484892779582879,
		-0.011509340089257526565380551630823902087,
		-0.012215840685544335220136247244226979092,
		-0.012917882778322238579438163696977426298,
		-0.013613025330333721266140578620706946822,
		-0.014298814025692080376117587547923903912,
		-0.01497279313735871628110452036253263941 ,
		-0.015632517552651818693032481633053976111,
		-0.01627556488532653708456443553131975932 ,
		-0.016899547601456909456940636005128908437,
		-0.017502125085568646239986279056211060379,
		-0.018081015573181365846400225905199476983,
		-0.018634007876166067824152960952233115677,
		-0.019158972828075236660705371605217806064,
		-0.019653874377891813324259473461097513791,
		-0.02011678026242446834515043008195789298 ,
		-0.02054587218988096486427252784778829664 ,
		-0.020939455469926076397468861500783532392,
		-0.021295968028796383869627462104290316347,
		-0.021613988751732437360031369166790682357,
		-0.021892245099128494756346441363348276354,
		-0.022129619947308571542565758250020735431,
		-0.022325157609728238372603925654402701184,
		-0.022478068999600583216524896101873309817,
		-0.022587735900450531256744568509020609781,
		-0.022653714316836888464923305264164810069,
		 0.977324259676378148675723878113785758615,
		-0.022653714316836888464923305264164810069,
		-0.022587735900450531256744568509020609781,
		-0.022478068999600583216524896101873309817,
		-0.022325157609728238372603925654402701184,
		-0.022129619947308571542565758250020735431,
		-0.021892245099128494756346441363348276354,
		-0.021613988751732437360031369166790682357,
		-0.021295968028796383869627462104290316347,
		-0.020939455469926076397468861500783532392,
		-0.02054587218988096486427252784778829664 ,
		-0.02011678026242446834515043008195789298 ,
		-0.019653874377891813324259473461097513791,
		-0.019158972828075236660705371605217806064,
		-0.018634007876166067824152960952233115677,
		-0.018081015573181365846400225905199476983,
		-0.017502125085568646239986279056211060379,
		-0.016899547601456909456940636005128908437,
		-0.01627556488532653708456443553131975932 ,
		-0.015632517552651818693032481633053976111,
		-0.01497279313735871628110452036253263941 ,
		-0.014298814025692080376117587547923903912,
		-0.013613025330333721266140578620706946822,
		-0.012917882778322238579438163696977426298,
		-0.012215840685544335220136247244226979092,
		-0.011509340089257526565380551630823902087,
		-0.010800797108336512505899484892779582879,
		-0.010092591598665236890530749747085792478,
		-0.009387056168402707970188636465991294244,
		-0.008686465614716868538502936303302703891,
		-0.0079930268400584796734120729411188222  ,
		-0.007308869302149423492764857002157441457,
		-0.006636036047643150380392906839688293985,
		-0.005976475374880869592675303181295021204,
		-0.00533203316639755970501868276301138394 ,
		-0.004704445926814728069775828345200352487,
		-0.004095334556581193413693497973326884676,
		-0.003506198886692798912662061283640468901,
		-0.002938412994103864386147284548655989056,
		-0.002393221312058830228808314899424658506,
		-0.001871735544088323028796838620735343284,
		-0.001374932384938617807232374978809730237,
		-0.000903652046319041498539936796419169696,
		-0.000458597580048976665063886759554634409,
		-0.000040334986055932940706477557446518745,
		 0.000350705912298404772972637566397224873,
		 0.000714229847820755693599270585991689586,
		 0.001050073770785017734930022470507537946,
		 0.001358203822901524367161574247120370273,
		 0.001638711658859137547394890788154953043,
		 0.001891810153921512751076794422999682865,
		 0.0021178285393052471465014097162793405  ,
		 0.002317207009932630620147042677103854658,
		 0.002490490851651269189892534683394842432,
		 0.002638324137105734802644096959056696505,
		 0.002761443041150475966039046227251674281,
		 0.002860668827985919215189936082310850907,
		 0.002936900563093465185704467046434729127,
		 0.002991107603527993433895071362371709256,
		 0.003024321920221848761928251647645993216,
		 0.003037630305648347708163958813543104043,
		 0.003032166519523437058641901487021641515,
		 0.003009103424174920399930543979394315102,
		 0.002969645159830809101608739553057603189,
		 0.002915019408353700276770315014118750696,
		 0.002846469791935691412421149948386300821,
		 0.002765248450957612930123374894719745498,
		 0.002672608842660579263339482025685356348,
		 0.002569798799479090442576811881281173555,
		 0.002458053882894811921488997796814146568,
		 0.002338591065493833554000957519747316837,
		 0.002212602770597516498030099540983428597,
		 0.002081251295402141657936434526732227823,
		 0.001945663640047682859182676118336985382,
		 0.001806926761458744513932916930798455724,
		 0.001666083267204702218419742898447566404,
		 0.001524127561023260087058606160326235113,
		 0.001382002448089829794303229348884087813,
		 0.001240596204598692865392339790275855194,
		 0.001100740112801376320919577445067716326,
		 0.000963206459320992895538349198858441014,
		 0.000828706991377273043120066375877286191,
		 0.000697891822512748953750982838784011619,
		 0.000571348776545641976951084295421878778,
		 0.000449603155787084971840850133872891092,
		 0.000333117917084995254252410834538977724,
		 0.000222294236985841781343783973845518176,
		 0.000117472445266562108855991353184577974,
		 0.000018933304279335539836237947697306083,
		-0.000073100390013512996068532900917347206,
		-0.000158461910767623034672346715723278976,
		-0.000237038433273460393208367791295643201,
		-0.000308768625628724399916763543316733376,
		-0.000373640025020531064449402780525133494,
		-0.000431686227929297316671664042075917678,
		-0.000482983922683650275693711950708575387,
		-0.000527649792698514186022051841717939169,
		-0.000565837318407209368363586232675288556,
		-0.000597733505380880839052970543434639694,
		-0.000623555565414505826374313990356768045,
		-0.000643547576471984036569629061830255523,
		-0.000657977146326249530579322044587797791,
		-0.000667132103532363531471494066948935142,
		-0.000671317238036444013764281191214422506,
		-0.000670851112275791289403514827682784016,
		-0.00066606296207608137877054232944828982 ,
		-0.000657289705024382436317209599252464614,
		-0.000644873072300383579427696112418288976,
		-0.000629156878206911995485284272433545993,
		-0.00061048443986648482078444244436354893 ,
		-0.000589196157762905984786594437707663019,
		-0.000565627266015876939593554073582026831,
		-0.00054010575950639812866510558464483438 ,
		-0.000512950503224078482693293334904183212,
		-0.000484469527508413319756563897300338795,
		-0.00045495851120855079546476118501630026 ,
		-0.00042469945320839361854042826038835301 ,
		-0.00039395953125877583578251517337776022 ,
		-0.00036299014564320771858776937257573536 ,
		-0.000332026143878859315763246717878587333,
		-0.000301285221432207408510939306012232919,
		-0.000270967492310102890749196058450820601,
		-0.000241255222381964547955293665104647971,
		-0.000212312717392478683426509933340753378,
		-0.000184286356848010888414071684060502321,
		-0.000157304764295797044545976994811553595,
		-0.000131479103969993577159108832930201061,
		-0.000106903493345251115282865117528388055,
		-0.000083655520820833113968158223361371029,
		-0.000061796857546517658561768815417281075,
		-0.000041373952297783854296919781035057895,
		-0.000022418798302432819816772807675064882,
		-0.000004949761012625058697515876421357817,
		 0.000011027544005112366697746693888770864,
		 0.000025519333625790565581864521860211426,
		 0.000038542710394313854183143824849722137,
		 0.000050124696245685911553946478846910395,
		 0.000060301256069734153529657977310662886,
		 0.000069116319951497283045026287506829021,
		 0.000076620812352964391819462597332801579,
		 0.00008287169589748757036681836574132376 ,
		 0.000087931036784550688483602653988668862,
		 0.000091865098205579683986882200130708043,
		 0.00009474346746058144434245174014819213 ,
		 0.000096638221794623647541849775777222931,
		 0.000097623137292800511179667599659381949,
		 0.000097772944495455937972787363587912068,
		 0.000097162633730613846209760164907009994,
		 0.000095866812511109642707188283061725542,
		 0.00009395911671711881167461111186156586 ,
		 0.00009151167668274805537965282953294377 ,
		 0.000088594638734302481961752073758020742,
		 0.000085275742189515601207952522067046175,
		 0.000081619951325856082507102795542408558,
		 0.000077689141362707571846976661866790437,
		 0.000073541837080832905457726533793305634,
		 0.000069233002321989327320674034726977197,
		 0.000064813878275052759655137923910928066,
		 0.000060331868160997161596500321101288478,
		 0.000055830465679190601781776981393790038,
		 0.000051349224369545443677834151152694631,
		 0.000046923764879943878202284840428504253,
		 0.000042585817003249633024095782696250012,
		 0.000038363293262821272419909462980669446,
		 0.000034280390776782843987105509064861053,
		 0.000030357718118531891557561330774461794,
		 0.00002661244391013232156190798649575413 ,
		 0.000023058463935834842985618878263842646,
		 0.000019706583640151562438402529919834194,
		 0.000016564712977944633955345449249918488,
		 0.000013638070708629183660251342480318471,
		 0.000010929395370623045944985692046191872,
		 0.000008439160332664095130490028440206629,
		 0.000006165790492643795155883884584469001,
		 0.000004105878379309211461452994162968366,
		 0.000002254397605251404101598354523527945,
		 0.000000604911817751532320185613427615534,
		-0.000000850222504220855400486832852136043,
		-0.000002119660856745947715557270435438042,
		-0.000003212884370318632226221555389655826,
		-0.000004140023373692794325673111749397393,
		-0.000004911691721948613221344036305904268,
		-0.000005538832563406060692891893365574774,
		-0.00000603257604315748129558466192334798 ,
		-0.000006404109273699532628128846395432205,
		-0.000006664558746316399588758162125801121,
		-0.00000682488521160732210230461317057582 ,
		-0.000006895790924118664881755334794544154,
		-0.00000688763902541243000629198056650182 ,
		-0.000006810384731814971728098249970084765,
		-0.00000667351789819131007065354174723204 ,
		-0.000006486016446994931648533863621786111,
		-0.000006256310082548356923839820431521019,
		-0.000005992253653705041965187114844093585,
		-0.00000570110948328748057235219187655062 ,
		-0.000005389537949461133355176598730418291,
		-0.000005063595581964733320342111899670101,
		-0.000004728739924038426198165362135394929,
		-0.000004389840408440710320099684832451103,
		-0.000004051194502068812136618986691205535,
		-0.000003716548387845536864675837288030102,
		-0.000003389121473598519991327245037826543,
		-0.000003071634044956596012570506845640317,
		-0.000002766337411863189636772666912811758,
		-0.000002475045935331314285882944523087268,
		-0.00000219917036169727498520049500940754 ,
		-0.000001939751935085209257991593900793958,
		-0.000001697496804250970462677209835145042,
		-0.000001472810286779863601323023805655943,
		-0.000001265830600987301026778180171317167,
		-0.000001076461723293720051990380107143075,
		-0.000000904405075640931790504457258444981,
		-0.000000749189793239281927920384263758224,
		-0.000000610201367095882416038694472798509,
		-0.000000486708497978596906420221349792721,
		-0.000000377888038388417897487216254998055,
		-0.000000282847936466454901847272004195011,
		-0.000000200648130318658459602231144101869,
		-0.000000130319372861519847654025185644533,
		-0.000000070879995828980403850946769451352,
		-0.000000021350647014439996376710575033513,
		 0.000000019232942908803300339465433728414,
		 0.000000051809088473199620455320973900701,
		 0.000000077281080783276037466922303836164,
		 0.000000096509817376506257407373806124495,
		 0.000000110308015457362109242838018544758,
		 0.00000011943588571992791571743208322437 ,
		 0.00000012459813881168979547805120058207 ,
		 0.000000126442193632156676504755036215266,
		 0.000000125557455911595042619276923513694,
		 0.000000122475536653037787412204632185586,
		 0.000000117671282842883252656928868857406,
		 0.000000111564497108562884631099466643117,
		 0.000000104522228523168200235414775252363,
		 0.000000096861523304694811775256157743846,
		 0.000000088852531532270105212937259288319,
		 0.000000080721874005645811423582470026106,
		 0.000000072656181823789986346831505040905,
		 0.000000064805729980505911972627299845462,
		 0.000000057288095114003862117524096438104,
		 0.000000050191776357107097173010503777038,
		 0.000000043579726891434926353241204391442,
		 0.000000037492752196601711142658226987717,
		 0.000000031952739012372796706084308350493,
		 0.000000026965686614022012454875258939853,
		 0.000000022524519076598420659007196865248,
		 0.000000018611663720799779268653335634505,
		 0.000000015201386856244240857062290052035,
		 0.000000012261883243811818052925920673971,
		 0.000000009757120376952029639136329129852,
		 0.00000000764844273212407746233032376738 ,
		 0.000000005895944571652311988393376445501,
		 0.00000000445962271637962409199788696261 ,
		 0.000000003300322967667351736921401645698,
		 0.000000002380495580571911390306229209146,
		 0.000000001664776410637526965299718560611,
		 0.000000002396930607626541243393302022219,
};


void FirFilter::FirFilterInit(FirData *fir)
{
	for (uint16_t n = 0; n < FIR_FILTER_LENGTH; n++)
	{
		fir->buf[n] = 0.0f;
	}

	fir->bufIndex = 0;
	fir->out = 0.0f;
}

double FirFilter::FirFilterUpdate(FirData *fir, double input)
{
	fir->buf[fir->bufIndex] = input;

	fir->bufIndex++;

	if (fir->bufIndex == FIR_FILTER_LENGTH)
	{
		fir->bufIndex = 0;
	}

	fir->out = 0.0f;

	uint16_t sumIndex = fir->bufIndex;

	for (uint16_t n = 0; n < FIR_FILTER_LENGTH; n++)
	{
		if (sumIndex > 0)
		{
			sumIndex--;
		}
		else
		{
			sumIndex = FIR_FILTER_LENGTH - 1;
		}

		fir->out += FIR_IMPULSE_RESPONSE[n]*fir->buf[sumIndex];

	}

	return fir->out;
}

