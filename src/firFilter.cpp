/*
 * firFilter.cpp
 *
 *  Created on: Apr 13, 2021
 *      Author: cjgree13
 */

#include "firFilter.h"

static float FIR_IMPULSE_RESPONSE[FIR_FILTER_LENGTH] =
{
		-0.000168667503076700174080918004371199004,
		-0.000163942908092159719563724040725105624,
		-0.000159130928845198973140342979526451472,
		-0.000154171109957553734842727877207835263,
		-0.000148992384489474735762698509589085916,
		-0.000143513593799076240786413705130541985,
		-0.000137644119744736830035503061253621127,
		-0.000131284626804236646000281774071538621,
		-0.000124327910882841380325533608974808431,
		-0.000116659850789705487141868778255826555,
		-0.000108160457586923343690707421949070977,
		-0.000098705016259529988558417412658485546,
		-0.000088165313427156333345342809071354395,
		-0.000076410944118349399247977493665473503,
		-0.000063310689967240637698181471293423783,
		-0.000048733960568914437853828974800407536,
		-0.000032552289152390022732627000712213317,
		-0.000014640873199866409414644438657937542,
		 0.000005119849835029974934529854030396123,
		 0.000026842601979664156794944465667107636,
		 0.000050631649995933532021775286269260619,
		 0.000076581187366069332724850815541373095,
		 0.000104773724175671368880752298835545844,
		 0.000135278496228808954018538179830954959,
		 0.000168149904827558126837322438618116394,
		 0.000203425998679133908418961707020855556,
		 0.000241127009351262383118202903276028337,
		 0.000281253951583300897901912529519563577,
		 0.000323787299574705342546793174207664379,
		 0.000368685750116908960826583863124028539,
		 0.000415885083105512170630752022404408308,
		 0.00046529712957359625150749460331667251 ,
		 0.00051680885692072925634982238918269104 ,
		 0.000570281580482191025570359865781711051,
		 0.000625550309985702362308712665139864839,
		 0.000682423238789683916927231166482670233,
		 0.000740681383081559507886026949563529342,
		 0.000800078377448954435567640697257729698,
		 0.000860340432416940381968317730354556261,
		 0.000921166458684650763660828332035634958,
		 0.000982228361886412684039759923848578183,
		 0.001043171510765201689951986452342680423,
		 0.0011036153806715546729644294998706755  ,
		 0.001163154373307120469788200622929252859,
		 0.001221358812609229117090992033922702831,
		 0.001277776115646154326752070851114240213,
		 0.001331932136347531003134347926675218332,
		 0.001383332678853363200896509077608698135,
		 0.001431465176223750690454039613541681319,
		 0.001475800529223097838638079082329568337,
		 0.001515795098873882942175361776548925263,
		 0.001550892845486656059991736889003277611,
		 0.001580527605903021956187948227068318374,
		 0.001604125499760208992811039152570629085,
		 0.001621107454688791712701934066842568427,
		 0.001630891839512270229117785191874645534,
		 0.001632897193713578939261443778718785325,
		 0.001626545040696556658835203457158513629,
		 0.001611262771682462745931330161397454503,
		 0.00158648658646837149507891062683029304 ,
		 0.001551664476720513233254372664760012412,
		 0.00150625923700263390780929029233448091 ,
		 0.001449751488335207331992204871085050399,
		 0.001381642698762335303222514859555758449,
		 0.001301458185160236447411308269295204809,
		 0.001208750080368311587142304830422290252,
		 0.001103100249648001794297580424597526871,
		 0.000984123140496024912532435635625915893,
		 0.000851468549936453770327071666201845801,
		 0.000704824293612415033773166417319089305,
		 0.000543918761270439704222368071384607902,
		 0.000368523343603688519933003764350587517,
		 0.000178454715862327433504100349104248835,
		-0.000026423035817357994997330375430699689,
		-0.000246196458805058356750228298892579915,
		-0.000480900961827130128331542202602122416,
		-0.000730519238248353124098866118174555595,
		-0.000994979895908430778117548243244527839,
		-0.001274156303729361136220510353211921029,
		-0.001567865664331086553162641905601049075,
		-0.00187586832086077213294084131689487549 ,
		-0.002197867305148444323076306616826514073,
		-0.002533508133170913820264580351704353234,
		-0.002882378852618766931770188932659948478,
		-0.003244010346151925995583642503561350168,
		-0.003617876892676029354500855106380186044,
		-0.004003396987710009478911299396486356272,
		-0.004399934422616593940325024902904260671,
		-0.004806799621182716863998507506039459258,
		-0.005223251230723316256010502200979317422,
		-0.005648497963596390766816135453609604156,
		-0.006081700683718120094278791754049962037,
		-0.006521974731410814553334009957552552805,
		-0.006968392478658215830056299466832570033,
		-0.007419986105641304674485070336231729016,
		-0.007875750588241811969703043416757282102,
		-0.008334646885077491573756702791797579266,
		-0.008795605311546573004677362916936544934,
		-0.009257529087339394849309748281029897043,
		-0.009719298042908374249404523936846089782,
		-0.01017977246950267818104141070989498985 ,
		-0.010637797096541085073440058295091148466,
		-0.011092205179366512041161385582199727651,
		-0.011541822679753472452590656871507235337,
		-0.011985472520973167870339537444124289323,
		-0.012421978898729384502286343661126011284,
		-0.012850171628888320402017697574592602905,
		-0.013268890512621697025386069412888900843,
		-0.013676989699390042914961540532203798648,
		-0.014073342028074128928771813207276863977,
		-0.014456843326573183897143515252992074238,
		-0.014826416650268788716138246286391222384,
		-0.01518101643995913713203194106426963117 ,
		-0.015519632580149284734050141310035542119,
		-0.01584129433898173386352503655416512629 ,
		-0.016145074171568143950317164581065298989,
		-0.016430091369071204987495349314485793002,
		-0.016695515536543560630722282667193212546,
		-0.016940569883296546088713441235995560419,
		-0.017164534310402053407518252470254083164,
		-0.017366748280861519365680933901785465423,
		-0.01754661345895490096036262173129216535 ,
		-0.017703596106360745127128453191289736424,
		-0.017837229223753421625264792282905546017,
		-0.01794711442778025578537182127547566779 ,
		-0.018032923554549735306595792394546151627,
		-0.018094399982056211251268962314497912303,
		-0.018131359665280285392574555203282216098,
		 0.982027322954664549925496430660132318735,
		-0.018131359665280285392574555203282216098,
		-0.018094399982056211251268962314497912303,
		-0.018032923554549735306595792394546151627,
		-0.01794711442778025578537182127547566779 ,
		-0.017837229223753421625264792282905546017,
		-0.017703596106360745127128453191289736424,
		-0.01754661345895490096036262173129216535 ,
		-0.017366748280861519365680933901785465423,
		-0.017164534310402053407518252470254083164,
		-0.016940569883296546088713441235995560419,
		-0.016695515536543560630722282667193212546,
		-0.016430091369071204987495349314485793002,
		-0.016145074171568143950317164581065298989,
		-0.01584129433898173386352503655416512629 ,
		-0.015519632580149284734050141310035542119,
		-0.01518101643995913713203194106426963117 ,
		-0.014826416650268788716138246286391222384,
		-0.014456843326573183897143515252992074238,
		-0.014073342028074128928771813207276863977,
		-0.013676989699390042914961540532203798648,
		-0.013268890512621697025386069412888900843,
		-0.012850171628888320402017697574592602905,
		-0.012421978898729384502286343661126011284,
		-0.011985472520973167870339537444124289323,
		-0.011541822679753472452590656871507235337,
		-0.011092205179366512041161385582199727651,
		-0.010637797096541085073440058295091148466,
		-0.01017977246950267818104141070989498985 ,
		-0.009719298042908374249404523936846089782,
		-0.009257529087339394849309748281029897043,
		-0.008795605311546573004677362916936544934,
		-0.008334646885077491573756702791797579266,
		-0.007875750588241811969703043416757282102,
		-0.007419986105641304674485070336231729016,
		-0.006968392478658215830056299466832570033,
		-0.006521974731410814553334009957552552805,
		-0.006081700683718120094278791754049962037,
		-0.005648497963596390766816135453609604156,
		-0.005223251230723316256010502200979317422,
		-0.004806799621182716863998507506039459258,
		-0.004399934422616593940325024902904260671,
		-0.004003396987710009478911299396486356272,
		-0.003617876892676029354500855106380186044,
		-0.003244010346151925995583642503561350168,
		-0.002882378852618766931770188932659948478,
		-0.002533508133170913820264580351704353234,
		-0.002197867305148444323076306616826514073,
		-0.00187586832086077213294084131689487549 ,
		-0.001567865664331086553162641905601049075,
		-0.001274156303729361136220510353211921029,
		-0.000994979895908430778117548243244527839,
		-0.000730519238248353124098866118174555595,
		-0.000480900961827130128331542202602122416,
		-0.000246196458805058356750228298892579915,
		-0.000026423035817357994997330375430699689,
		 0.000178454715862327433504100349104248835,
		 0.000368523343603688519933003764350587517,
		 0.000543918761270439704222368071384607902,
		 0.000704824293612415033773166417319089305,
		 0.000851468549936453770327071666201845801,
		 0.000984123140496024912532435635625915893,
		 0.001103100249648001794297580424597526871,
		 0.001208750080368311587142304830422290252,
		 0.001301458185160236447411308269295204809,
		 0.001381642698762335303222514859555758449,
		 0.001449751488335207331992204871085050399,
		 0.00150625923700263390780929029233448091 ,
		 0.001551664476720513233254372664760012412,
		 0.00158648658646837149507891062683029304 ,
		 0.001611262771682462745931330161397454503,
		 0.001626545040696556658835203457158513629,
		 0.001632897193713578939261443778718785325,
		 0.001630891839512270229117785191874645534,
		 0.001621107454688791712701934066842568427,
		 0.001604125499760208992811039152570629085,
		 0.001580527605903021956187948227068318374,
		 0.001550892845486656059991736889003277611,
		 0.001515795098873882942175361776548925263,
		 0.001475800529223097838638079082329568337,
		 0.001431465176223750690454039613541681319,
		 0.001383332678853363200896509077608698135,
		 0.001331932136347531003134347926675218332,
		 0.001277776115646154326752070851114240213,
		 0.001221358812609229117090992033922702831,
		 0.001163154373307120469788200622929252859,
		 0.0011036153806715546729644294998706755  ,
		 0.001043171510765201689951986452342680423,
		 0.000982228361886412684039759923848578183,
		 0.000921166458684650763660828332035634958,
		 0.000860340432416940381968317730354556261,
		 0.000800078377448954435567640697257729698,
		 0.000740681383081559507886026949563529342,
		 0.000682423238789683916927231166482670233,
		 0.000625550309985702362308712665139864839,
		 0.000570281580482191025570359865781711051,
		 0.00051680885692072925634982238918269104 ,
		 0.00046529712957359625150749460331667251 ,
		 0.000415885083105512170630752022404408308,
		 0.000368685750116908960826583863124028539,
		 0.000323787299574705342546793174207664379,
		 0.000281253951583300897901912529519563577,
		 0.000241127009351262383118202903276028337,
		 0.000203425998679133908418961707020855556,
		 0.000168149904827558126837322438618116394,
		 0.000135278496228808954018538179830954959,
		 0.000104773724175671368880752298835545844,
		 0.000076581187366069332724850815541373095,
		 0.000050631649995933532021775286269260619,
		 0.000026842601979664156794944465667107636,
		 0.000005119849835029974934529854030396123,
		-0.000014640873199866409414644438657937542,
		-0.000032552289152390022732627000712213317,
		-0.000048733960568914437853828974800407536,
		-0.000063310689967240637698181471293423783,
		-0.000076410944118349399247977493665473503,
		-0.000088165313427156333345342809071354395,
		-0.000098705016259529988558417412658485546,
		-0.000108160457586923343690707421949070977,
		-0.000116659850789705487141868778255826555,
		-0.000124327910882841380325533608974808431,
		-0.000131284626804236646000281774071538621,
		-0.000137644119744736830035503061253621127,
		-0.000143513593799076240786413705130541985,
		-0.000148992384489474735762698509589085916,
		-0.000154171109957553734842727877207835263,
		-0.000159130928845198973140342979526451472,
		-0.000163942908092159719563724040725105624,
		-0.000168667503076700174080918004371199004,

};


void FirFilter::FirFilterInit(FirData *fir)
{

	for (uint16_t n = 0; n < FIR_FILTER_LENGTH; n++)
	{
		fir->buf[n] = 0.0f;
	}

	fir->bufIndex = 0;
	fir->out = 0.0f;
}

double FirFilter::FirFilterUpdate(FirData *fir, double input)
{
	fir->buf[fir->bufIndex] = input;

	fir->bufIndex++;

	if (fir->bufIndex == FIR_FILTER_LENGTH)
	{
		fir->bufIndex = 0;
	}

	fir->out = 0.0f;

	uint16_t sumIndex = fir->bufIndex;

	for (uint16_t n = 0; n < FIR_FILTER_LENGTH; n++)
	{
		if (sumIndex > 0)
		{
			sumIndex--;
		}
		else
		{
			sumIndex = FIR_FILTER_LENGTH - 1;
		}

		fir->out += FIR_IMPULSE_RESPONSE[n]*fir->buf[sumIndex];

	}

	return fir->out;
}
